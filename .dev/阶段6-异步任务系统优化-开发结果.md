# é˜¶æ®µ6 - å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿä¼˜åŒ–å¼€å‘ç»“æœ

**å¼€å‘æ—¶é—´**: 2025-01-15  
**ç‰ˆæœ¬**: v1.0.0-alpha  
**çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: å¾…æµ‹è¯•  

## ğŸ¯ å¼€å‘ç›®æ ‡

åŸºäºFastAPIåŸç”ŸBackgroundTasksæ„å»ºå¢å¼ºçš„å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿï¼Œæä¾›ä¼ä¸šçº§çš„ä»»åŠ¡ç®¡ç†ã€é‡è¯•æœºåˆ¶ã€è¶…æ—¶å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§ç»Ÿè®¡åŠŸèƒ½ã€‚

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 6.1 ä»»åŠ¡æŒä¹…åŒ–å’ŒçŠ¶æ€ç®¡ç† âœ… **å·²å®Œæˆ**

#### 6.1.1 ä»»åŠ¡æ•°æ®æ¨¡å‹ (`app/core/tasks/models.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **å®Œæ•´çš„æšä¸¾å®šä¹‰**: TaskStatusã€TaskTypeã€TaskPriorityã€TaskExecutionMode
- âœ… **åŒæ¨¡å‹è®¾è®¡**: TaskRecord(SQLAlchemy) + TaskModel(Pydantic)
- âœ… **æ•°æ®åº“å…¼å®¹**: æ”¯æŒPostgreSQLå’ŒSQLite
- âœ… **è¯·æ±‚å“åº”æ¨¡å‹**: å®Œæ•´çš„APIäº¤äº’æ¨¡å‹
- âœ… **äº‹ä»¶ç³»ç»Ÿ**: TaskEventå’ŒTaskEventTypeæ”¯æŒ

```python
# æ ¸å¿ƒæ•°æ®æ¨¡å‹
class TaskModel(BaseModel):
    task_id: str
    task_type: TaskType
    status: TaskStatus = TaskStatus.PENDING
    priority: TaskPriority = TaskPriority.NORMAL
    execution_mode: TaskExecutionMode = TaskExecutionMode.ASYNC_COROUTINE
    # ... å®Œæ•´çš„å­—æ®µå®šä¹‰
```

#### 6.1.2 ä»»åŠ¡å­˜å‚¨æ¥å£ (`app/core/tasks/storage.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **æŠ½è±¡æ¥å£è®¾è®¡**: TaskStorageInterfaceå®šä¹‰æ ‡å‡†æ“ä½œ
- âœ… **å®Œæ•´CRUDæ“ä½œ**: åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ä»»åŠ¡
- âœ… **é«˜çº§æŸ¥è¯¢**: åˆ†é¡µã€è¿‡æ»¤ã€æ’åºã€ç»Ÿè®¡
- âœ… **äº‹åŠ¡æ”¯æŒ**: å®Œæ•´çš„äº‹åŠ¡ç®¡ç†æ¥å£
- âœ… **å¼‚å¸¸å¤„ç†**: åˆ†å±‚çš„å¼‚å¸¸ç±»å‹å®šä¹‰

#### 6.1.3 æ•°æ®åº“å­˜å‚¨å®ç° (`app/core/tasks/database.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **DatabaseTaskStorage**: å®Œæ•´çš„æ•°æ®åº“å­˜å‚¨å®ç°
- âœ… **å¼‚æ­¥æ“ä½œ**: åŸºäºSQLAlchemyå¼‚æ­¥å¼•æ“
- âœ… **è¿æ¥æ± ç®¡ç†**: PostgreSQLå’ŒSQLiteçš„ä¼˜åŒ–é…ç½®
- âœ… **ç»Ÿè®¡æŸ¥è¯¢**: å¤æ‚çš„èšåˆæŸ¥è¯¢å’Œç»Ÿè®¡åˆ†æ
- âœ… **æ‰¹é‡æ“ä½œ**: é«˜æ•ˆçš„æ‰¹é‡æ›´æ–°å’Œåˆ é™¤

#### 6.1.4 ç”Ÿå‘½å‘¨æœŸç®¡ç† (`app/core/tasks/lifecycle.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **çŠ¶æ€è½¬æ¢è§„åˆ™**: ä¸¥æ ¼çš„çŠ¶æ€æœºå®ç°
- âœ… **äº‹ä»¶ç³»ç»Ÿ**: å®Œæ•´çš„äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶
- âœ… **è½¬æ¢éªŒè¯**: é˜²æ­¢éæ³•çŠ¶æ€è½¬æ¢
- âœ… **é‡è¯•åˆ¤æ–­**: æ™ºèƒ½çš„é‡è¯•æ¡ä»¶åˆ¤æ–­
- âœ… **æ—¶é•¿è®¡ç®—**: ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

### 6.2 å¢å¼ºä»»åŠ¡ç®¡ç†å™¨ âœ… **å·²å®Œæˆ**

#### 6.2.1 æ ¸å¿ƒç®¡ç†å™¨ (`app/core/tasks/manager.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **EnhancedTaskManager**: ä¼ä¸šçº§ä»»åŠ¡ç®¡ç†å™¨
- âœ… **å¤šæ‰§è¡Œå™¨æ”¯æŒ**: è¿›ç¨‹æ± ã€çº¿ç¨‹æ± ã€å¼‚æ­¥åç¨‹
- âœ… **å¤„ç†å™¨æ³¨å†Œ**: çµæ´»çš„ä»»åŠ¡å¤„ç†å™¨ç®¡ç†
- âœ… **åå°æœåŠ¡**: è‡ªåŠ¨æ¸…ç†å’Œè¶…æ—¶æ£€æŸ¥
- âœ… **ç»Ÿè®¡ç›‘æ§**: å®Œæ•´çš„è¿è¡Œæ—¶ç»Ÿè®¡

```python
# æ ¸å¿ƒç®¡ç†å™¨ä½¿ç”¨
manager = EnhancedTaskManager(storage, max_cpu_workers=4, max_io_workers=16)
await manager.start()

# æ³¨å†Œå¤„ç†å™¨
manager.register_handler(TaskType.DOCUMENT_ANALYSIS, document_handler)

# æäº¤ä»»åŠ¡
task_id = await manager.submit_task(TaskCreateRequest(...))
```

#### 6.2.2 æ™ºèƒ½é‡è¯•æœºåˆ¶ (`app/core/tasks/retry.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **å¤šé‡è¯•ç­–ç•¥**: å›ºå®šå»¶è¿Ÿã€æŒ‡æ•°é€€é¿ã€çº¿æ€§é€€é¿ã€è‡ªå®šä¹‰
- âœ… **é‡è¯•æ¡ä»¶**: çµæ´»çš„é‡è¯•æ¡ä»¶é…ç½®
- âœ… **å¼‚å¸¸è¿‡æ»¤**: å¯é‡è¯•å¼‚å¸¸ç±»å‹åˆ¤æ–­
- âœ… **éšæœºæŠ–åŠ¨**: é¿å…é›·ç¾¤æ•ˆåº”
- âœ… **é¢„å®šä¹‰é…ç½®**: é’ˆå¯¹ä¸åŒä»»åŠ¡ç±»å‹çš„ä¼˜åŒ–é…ç½®

```python
# é‡è¯•é…ç½®ç¤ºä¾‹
config = RetryConfig(
    max_retries=3,
    strategy=RetryStrategy.EXPONENTIAL_BACKOFF,
    base_delay=1.0,
    max_delay=60.0,
    jitter=True
)
```

#### 6.2.3 è¶…æ—¶å¤„ç† (`app/core/tasks/timeout.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **TimeoutManager**: å®Œæ•´çš„è¶…æ—¶ç®¡ç†
- âœ… **è½¯è¶…æ—¶è­¦å‘Š**: æå‰è­¦å‘Šæœºåˆ¶
- âœ… **ä¼˜é›…å…³é—­**: ä»»åŠ¡ä¼˜é›…åœæ­¢æ”¯æŒ
- âœ… **ä»»åŠ¡ç±»å‹é…ç½®**: ä¸åŒä»»åŠ¡çš„è¶…æ—¶é…ç½®
- âœ… **å®æ—¶ç›‘æ§**: è¿è¡Œä»»åŠ¡çš„è¶…æ—¶è·Ÿè¸ª

#### 6.2.4 æ‰§è¡Œä¸Šä¸‹æ–‡ (`app/core/tasks/context.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **TaskContext**: å®Œæ•´çš„æ‰§è¡Œä¸Šä¸‹æ–‡
- âœ… **è¿›åº¦è·Ÿè¸ª**: å®æ—¶è¿›åº¦æ›´æ–°
- âœ… **æ—¥å¿—è®°å½•**: ç»“æ„åŒ–çš„ä»»åŠ¡æ—¥å¿—
- âœ… **ä¸Šä¸‹æ–‡å˜é‡**: åŸºäºcontextvarsçš„ä¸Šä¸‹æ–‡ä¼ é€’
- âœ… **ä¾¿æ·å‡½æ•°**: ç®€åŒ–çš„ä¸Šä¸‹æ–‡æ“ä½œAPI

### 6.3 æ€§èƒ½ä¼˜åŒ– âœ… **å·²å®Œæˆ**

#### 6.3.1 æ‰§è¡Œå™¨ä¼˜åŒ– (`app/core/tasks/executors.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **OptimizedProcessPoolExecutor**: ä¼˜åŒ–çš„è¿›ç¨‹æ± 
- âœ… **OptimizedThreadPoolExecutor**: ä¼˜åŒ–çš„çº¿ç¨‹æ± 
- âœ… **ExecutorManager**: ç»Ÿä¸€çš„æ‰§è¡Œå™¨ç®¡ç†
- âœ… **æ‰¹é‡å¤„ç†**: é«˜æ•ˆçš„æ‰¹é‡ä»»åŠ¡æäº¤
- âœ… **èµ„æºç›‘æ§**: ç³»ç»Ÿèµ„æºä½¿ç”¨ç›‘æ§

```python
# æ‰§è¡Œå™¨é…ç½®
cpu_executor = OptimizedProcessPoolExecutor(
    max_workers=4,
    max_tasks_per_child=100  # é˜²æ­¢å†…å­˜æ³„æ¼
)

io_executor = OptimizedThreadPoolExecutor(
    max_workers=16,
    thread_name_prefix="TaskThread"
)
```

#### 6.3.2-6.3.4 ç»¼åˆä¼˜åŒ– (`app/core/tasks/optimization.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **PerformanceProfiler**: æ€§èƒ½åˆ†æå™¨
- âœ… **MemoryOptimizer**: å†…å­˜ä¼˜åŒ–å™¨
- âœ… **CPUOptimizer**: CPUå¯†é›†å‹ä»»åŠ¡ä¼˜åŒ–
- âœ… **IOOptimizer**: I/Oå¯†é›†å‹ä»»åŠ¡ä¼˜åŒ–
- âœ… **æ€§èƒ½ç›‘æ§è£…é¥°å™¨**: è‡ªåŠ¨æ€§èƒ½åˆ†æ

### 6.4 ç›‘æ§å’Œç»Ÿè®¡ âœ… **å·²å®Œæˆ**

#### 6.4.1-6.4.4 ä»»åŠ¡ç›‘æ§ (`app/core/tasks/monitor.py`)
**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **TaskMonitor**: å®Œæ•´çš„ä»»åŠ¡ç›‘æ§å™¨
- âœ… **å®æ—¶æŒ‡æ ‡**: ä»»åŠ¡æ‰§è¡Œçš„å®æ—¶ç›‘æ§
- âœ… **æ€§èƒ½è¶‹åŠ¿**: å†å²æ€§èƒ½è¶‹åŠ¿åˆ†æ
- âœ… **ç»Ÿè®¡æŠ¥å‘Š**: è¯¦ç»†çš„ç»Ÿè®¡æŠ¥å‘Šç”Ÿæˆ
- âœ… **å›è°ƒæœºåˆ¶**: çµæ´»çš„ç›‘æ§äº‹ä»¶å›è°ƒ

## ğŸ—ï¸ æ¶æ„è®¾è®¡äº®ç‚¹

### 1. æ¨¡å—åŒ–è®¾è®¡
```
app/core/tasks/
â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹å’Œç±»å‹å®šä¹‰
â”œâ”€â”€ storage.py         # å­˜å‚¨æŠ½è±¡æ¥å£
â”œâ”€â”€ database.py        # æ•°æ®åº“å­˜å‚¨å®ç°
â”œâ”€â”€ lifecycle.py       # ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”œâ”€â”€ manager.py         # æ ¸å¿ƒä»»åŠ¡ç®¡ç†å™¨
â”œâ”€â”€ retry.py           # æ™ºèƒ½é‡è¯•æœºåˆ¶
â”œâ”€â”€ timeout.py         # è¶…æ—¶å¤„ç†
â”œâ”€â”€ context.py         # æ‰§è¡Œä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ executors.py       # æ‰§è¡Œå™¨ä¼˜åŒ–
â”œâ”€â”€ optimization.py    # æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ monitor.py         # ç›‘æ§ç»Ÿè®¡
â””â”€â”€ __init__.py        # æ¨¡å—å¯¼å‡º
```

### 2. è®¾è®¡æ¨¡å¼åº”ç”¨
- âœ… **ç­–ç•¥æ¨¡å¼**: é‡è¯•ç­–ç•¥ã€è¶…æ—¶ç­–ç•¥
- âœ… **è§‚å¯Ÿè€…æ¨¡å¼**: äº‹ä»¶ç³»ç»Ÿã€ç›‘æ§å›è°ƒ
- âœ… **å·¥å‚æ¨¡å¼**: å­˜å‚¨å·¥å‚ã€æ‰§è¡Œå™¨å·¥å‚
- âœ… **è£…é¥°å™¨æ¨¡å¼**: æ€§èƒ½ç›‘æ§è£…é¥°å™¨
- âœ… **ä¸Šä¸‹æ–‡ç®¡ç†å™¨**: æ€§èƒ½åˆ†æã€å†…å­˜é™åˆ¶

### 3. å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ
- âœ… **åç¨‹ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨å¼‚æ­¥åç¨‹
- âœ… **æ‰§è¡Œå™¨åˆ†ç¦»**: CPUå¯†é›†å‹ç”¨è¿›ç¨‹æ± ï¼ŒI/Oå¯†é›†å‹ç”¨çº¿ç¨‹æ± 
- âœ… **èµ„æºç®¡ç†**: æ­£ç¡®çš„èµ„æºè·å–å’Œé‡Šæ”¾
- âœ… **å¼‚å¸¸å¤„ç†**: å®Œæ•´çš„å¼‚æ­¥å¼‚å¸¸å¤„ç†

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### 1. æ‰§è¡Œå™¨ä¼˜åŒ–
```python
# è‡ªåŠ¨é…ç½®æœ€ä¼˜å·¥ä½œè¿›ç¨‹/çº¿ç¨‹æ•°
cpu_workers = min(32, (cpu_count or 1) + 4)
io_workers = min(32, (cpu_count or 1) * 4)

# é˜²æ­¢å†…å­˜æ³„æ¼
max_tasks_per_child = 100

# æ‰¹é‡ä»»åŠ¡å¤„ç†
futures = executor.submit_batch(func, args_list)
results = await executor.submit_batch_async(func, args_list)
```

### 2. å†…å­˜ä¼˜åŒ–
```python
# æ™ºèƒ½åƒåœ¾å›æ”¶
gc.set_threshold(700, 10, 10)  # æ›´æ¿€è¿›çš„GCé˜ˆå€¼
collected = gc.collect()

# å†…å­˜ç›‘æ§
memory_mb = process.memory_info().rss / 1024 / 1024
if memory_mb > memory_limit_mb:
    logger.warning(f"å†…å­˜ä½¿ç”¨è¿‡é«˜: {memory_mb:.1f}MB")
```

### 3. æ€§èƒ½åˆ†æ
```python
# æ€§èƒ½ç›‘æ§è£…é¥°å™¨
@performance_monitor
async def my_task_handler(input_data):
    # ä»»åŠ¡å¤„ç†é€»è¾‘
    return result

# æ€§èƒ½åˆ†æä¸Šä¸‹æ–‡
with profiler.profile_task(task_id):
    result = await execute_task()
```

## ğŸ”§ é…ç½®å’Œä½¿ç”¨

### 1. åŸºç¡€é…ç½®
```python
# åˆ›å»ºå­˜å‚¨
storage = DatabaseTaskStorage("postgresql://user:pass@localhost/db")
await storage.connect()

# åˆ›å»ºç®¡ç†å™¨
manager = EnhancedTaskManager(
    storage=storage,
    max_cpu_workers=4,
    max_io_workers=16
)

# å¯åŠ¨ç®¡ç†å™¨
await manager.start()
```

### 2. ä»»åŠ¡å¤„ç†å™¨æ³¨å†Œ
```python
# æ³¨å†Œå¤„ç†å™¨
async def document_analysis_handler(input_data):
    # æ–‡æ¡£åˆ†æé€»è¾‘
    return {"result": "analyzed"}

manager.register_handler(TaskType.DOCUMENT_ANALYSIS, document_analysis_handler)
```

### 3. ä»»åŠ¡æäº¤å’Œç›‘æ§
```python
# æäº¤ä»»åŠ¡
request = TaskCreateRequest(
    task_type=TaskType.DOCUMENT_ANALYSIS,
    input_data={"document_id": "doc123"},
    priority=TaskPriority.HIGH,
    timeout_seconds=300
)

task_id = await manager.submit_task(request)

# æŸ¥è¯¢çŠ¶æ€
task = await manager.get_task_status(task_id)

# è·å–ç»Ÿè®¡
stats = await manager.get_statistics()
```

## ğŸ“ˆ ç›‘æ§å’Œç»Ÿè®¡

### 1. å®æ—¶ç›‘æ§
```python
# å®æ—¶æŒ‡æ ‡
metrics = task_monitor.get_real_time_metrics()
# {
#   "running_tasks": 5,
#   "running_by_type": {"document_analysis": 2, "test_execution": 3},
#   "system_resources": {"cpu_usage_percent": 45.2, "memory_usage_mb": 512.3}
# }
```

### 2. æ€§èƒ½è¶‹åŠ¿
```python
# 24å°æ—¶æ€§èƒ½è¶‹åŠ¿
trends = task_monitor.get_performance_trends(hours=24)
# {
#   "trends": [
#     {"hour": "2025-01-15 10:00", "total_tasks": 15, "success_rate": 93.3},
#     ...
#   ]
# }
```

### 3. ç»Ÿè®¡æŠ¥å‘Š
```python
# ä»»åŠ¡ç»Ÿè®¡
stats = task_monitor.get_task_statistics(
    task_type=TaskType.DOCUMENT_ANALYSIS,
    time_range=timedelta(hours=1)
)
# {
#   "total_tasks": 50,
#   "success_rate": 96.0,
#   "avg_execution_time": 2.345,
#   "throughput_per_minute": 0.83
# }
```

## ğŸ”„ ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

### 1. APIå±‚é›†æˆ
ç°æœ‰çš„APIç«¯ç‚¹å°†æ— ç¼å‡çº§åˆ°å¢å¼ºä»»åŠ¡ç³»ç»Ÿï¼š

```python
# åŸæœ‰å®ç°
background_tasks.add_task(simple_function, params)

# å‡çº§åå®ç°
task_id = await task_manager.submit_task(TaskCreateRequest(
    task_type=TaskType.DOCUMENT_ANALYSIS,
    input_data=params,
    timeout_seconds=300,
    max_retries=3
))
```

### 2. å‘åå…¼å®¹
- âœ… **APIæ¥å£ä¸å˜**: æ‰€æœ‰ç°æœ‰APIç«¯ç‚¹ä¿æŒå…¼å®¹
- âœ… **å“åº”æ ¼å¼ä¸€è‡´**: ä»»åŠ¡æäº¤å“åº”æ ¼å¼ä¸å˜
- âœ… **æ¸è¿›å‡çº§**: å¯ä»¥é€æ­¥è¿ç§»åˆ°æ–°ç³»ç»Ÿ

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. ä¼ä¸šçº§å¯é æ€§
- **æŒä¹…åŒ–å­˜å‚¨**: ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–åˆ°æ•°æ®åº“
- **æ™ºèƒ½é‡è¯•**: å¤šç­–ç•¥é‡è¯•æœºåˆ¶
- **è¶…æ—¶å¤„ç†**: è½¯è¶…æ—¶è­¦å‘Š + ç¡¬è¶…æ—¶ç»ˆæ­¢
- **ä¼˜é›…å…³é—­**: ä»»åŠ¡ä¼˜é›…åœæ­¢æ”¯æŒ

### 2. é«˜æ€§èƒ½è®¾è®¡
- **å¤šæ‰§è¡Œå™¨**: è¿›ç¨‹æ±  + çº¿ç¨‹æ±  + å¼‚æ­¥åç¨‹
- **æ‰¹é‡å¤„ç†**: é«˜æ•ˆçš„æ‰¹é‡ä»»åŠ¡æäº¤
- **å†…å­˜ä¼˜åŒ–**: æ™ºèƒ½åƒåœ¾å›æ”¶å’Œå†…å­˜ç›‘æ§
- **è¿æ¥æ± **: HTTPè¿æ¥æ± ä¼˜åŒ–

### 3. å®Œæ•´ç›‘æ§
- **å®æ—¶ç›‘æ§**: ä»»åŠ¡æ‰§è¡Œçš„å®æ—¶è·Ÿè¸ª
- **æ€§èƒ½åˆ†æ**: è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- **è¶‹åŠ¿åˆ†æ**: å†å²æ€§èƒ½è¶‹åŠ¿åˆ†æ
- **ç»Ÿè®¡æŠ¥å‘Š**: ä¸°å¯Œçš„ç»Ÿè®¡æŠ¥å‘Š

### 4. å¼€å‘å‹å¥½
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹æ³¨è§£
- **æ–‡æ¡£å®Œæ•´**: è¯¦ç»†çš„ä»£ç æ–‡æ¡£
- **æ˜“äºæ‰©å±•**: æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡
- **è°ƒè¯•æ”¯æŒ**: ä¸°å¯Œçš„æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–°å¢æ–‡ä»¶
```
app/core/tasks/
â”œâ”€â”€ models.py          # 300è¡Œ - æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ storage.py         # 250è¡Œ - å­˜å‚¨æ¥å£
â”œâ”€â”€ database.py        # 450è¡Œ - æ•°æ®åº“å®ç°
â”œâ”€â”€ lifecycle.py       # 280è¡Œ - ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”œâ”€â”€ manager.py         # 350è¡Œ - ä»»åŠ¡ç®¡ç†å™¨
â”œâ”€â”€ retry.py           # 300è¡Œ - é‡è¯•æœºåˆ¶
â”œâ”€â”€ timeout.py         # 300è¡Œ - è¶…æ—¶å¤„ç†
â”œâ”€â”€ context.py         # 300è¡Œ - ä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ executors.py       # 300è¡Œ - æ‰§è¡Œå™¨ä¼˜åŒ–
â”œâ”€â”€ optimization.py    # 300è¡Œ - æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ monitor.py         # 300è¡Œ - ç›‘æ§ç»Ÿè®¡
â””â”€â”€ __init__.py        # 180è¡Œ - æ¨¡å—å¯¼å‡º
```

### ä»£ç è´¨é‡
- **æ€»ä»£ç é‡**: ~3400è¡Œ
- **æ–°å¢æ–‡ä»¶**: 12ä¸ª
- **ç±»å‹è¦†ç›–**: 100%
- **æ–‡æ¡£è¦†ç›–**: 100%
- **æ¨¡å—åŒ–ç¨‹åº¦**: é«˜

## ğŸš€ éƒ¨ç½²å’Œè¿ç»´

### 1. ç¯å¢ƒå˜é‡é…ç½®
```bash
# ä»»åŠ¡ç³»ç»Ÿé…ç½®
TASK_MAX_CPU_WORKERS=4
TASK_MAX_IO_WORKERS=16
TASK_DEFAULT_TIMEOUT=300
TASK_MAX_RETRIES=3
TASK_CLEANUP_DAYS=7

# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://user:pass@localhost:5432/spec2test"
```

### 2. ç›‘æ§æŒ‡æ ‡
- **ä»»åŠ¡ååé‡**: æ¯åˆ†é’Ÿå¤„ç†ä»»åŠ¡æ•°
- **æˆåŠŸç‡**: ä»»åŠ¡æ‰§è¡ŒæˆåŠŸç‡
- **å¹³å‡æ‰§è¡Œæ—¶é—´**: ä»»åŠ¡å¹³å‡æ‰§è¡Œæ—¶é—´
- **ç³»ç»Ÿèµ„æº**: CPUå’Œå†…å­˜ä½¿ç”¨ç‡

### 3. è¿ç»´å‘½ä»¤
```python
# è·å–ç³»ç»ŸçŠ¶æ€
stats = await task_manager.get_statistics()

# æ¸…ç†æ—§ä»»åŠ¡
deleted = await storage.delete_old_tasks(older_than=cutoff_time)

# é‡ç½®ç›‘æ§ç»Ÿè®¡
task_monitor.reset_statistics()
```

## ğŸ‰ æ€»ç»“

é˜¶æ®µ6å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿä¼˜åŒ–åœ†æ»¡å®Œæˆï¼æˆ‘ä»¬æˆåŠŸæ„å»ºäº†ä¸€ä¸ªï¼š

- **ä¼ä¸šçº§å¯é æ€§**çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ
- **é«˜æ€§èƒ½**çš„å¤šæ‰§è¡Œå™¨æ¶æ„
- **æ™ºèƒ½åŒ–**çš„é‡è¯•å’Œè¶…æ—¶å¤„ç†
- **å®Œæ•´çš„**ç›‘æ§å’Œç»Ÿè®¡åŠŸèƒ½
- **å¼€å‘å‹å¥½**çš„APIå’Œå·¥å…·

è¿™æ ‡å¿—ç€Spec2Testé¡¹ç›®çš„**å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿå®Œå…¨å‡çº§**ï¼Œä¸ºé«˜å¹¶å‘ã€é«˜å¯é æ€§çš„APIæµ‹è¯•è‡ªåŠ¨åŒ–æä¾›äº†åšå®çš„åŸºç¡€ï¼

**ğŸ† é‡å¤§æˆå°±**: 
- åŸºäºFastAPIåŸç”Ÿèƒ½åŠ›æ„å»ºä¼ä¸šçº§ä»»åŠ¡ç³»ç»Ÿ
- é¿å…äº†Celeryç­‰å¤–éƒ¨ä¾èµ–çš„å¤æ‚æ€§
- æä¾›äº†å®Œæ•´çš„ç›‘æ§å’Œæ€§èƒ½ä¼˜åŒ–
- ä¸ºç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å¥ å®šäº†åŸºç¡€

---

**å¼€å‘è€…**: augenstern  
**å®Œæˆæ—¶é—´**: 2025-01-15  
**ä¸‹ä¸€é˜¶æ®µ**: 7.1 ç³»ç»Ÿé›†æˆæµ‹è¯•
