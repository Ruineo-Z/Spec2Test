# Spec2Test 环境变量配置指南

**版本**: v0.5.0-alpha  
**更新时间**: 2025-01-15  
**适用范围**: 所有部署环境  

## 📋 概述

Spec2Test 使用环境变量进行配置管理，支持灵活的部署和运行时配置。本文档详细说明了所有可用的环境变量及其用途。

## 🚀 并发配置 (新增)

### SPEC2TEST_MAX_CONCURRENT_WORKERS
- **描述**: 测试生成时的最大并发工作线程数
- **默认值**: `8`
- **类型**: 整数
- **范围**: 1-50
- **用途**: 控制同时生成测试用例的线程数量，影响生成速度和资源使用

**使用建议**:
```bash
# 本地开发 (资源有限)
export SPEC2TEST_MAX_CONCURRENT_WORKERS=3

# 生产环境 (云端LLM)
export SPEC2TEST_MAX_CONCURRENT_WORKERS=10

# 高性能服务器
export SPEC2TEST_MAX_CONCURRENT_WORKERS=15
```

### SPEC2TEST_CONCURRENT_THRESHOLD
- **描述**: 启用并发的端点数量阈值
- **默认值**: `3`
- **类型**: 整数
- **范围**: 1-100
- **用途**: 当API端点数量达到此阈值时，自动启用并发生成

**使用建议**:
```bash
# 总是启用并发
export SPEC2TEST_CONCURRENT_THRESHOLD=1

# 保守策略 (仅大型API启用)
export SPEC2TEST_CONCURRENT_THRESHOLD=10

# 默认策略
export SPEC2TEST_CONCURRENT_THRESHOLD=3
```

## 🗄️ 数据库配置

### DB_HOST
- **描述**: PostgreSQL数据库主机地址
- **默认值**: `localhost`
- **示例**: `db.example.com`

### DB_PORT
- **描述**: PostgreSQL数据库端口
- **默认值**: `5432`
- **示例**: `5432`

### DB_NAME
- **描述**: 数据库名称
- **默认值**: `spec2test`
- **示例**: `spec2test_prod`

### DB_USER
- **描述**: 数据库用户名
- **默认值**: `spec2test_user`
- **示例**: `app_user`

### DB_PASSWORD
- **描述**: 数据库密码
- **默认值**: `""`
- **示例**: `secure_password_123`

### DB_ECHO
- **描述**: 启用SQLAlchemy查询日志
- **默认值**: `false`
- **示例**: `true`

## 🔴 Redis配置

### REDIS_HOST
- **描述**: Redis服务器主机地址
- **默认值**: `localhost`
- **示例**: `redis.example.com`

### REDIS_PORT
- **描述**: Redis服务器端口
- **默认值**: `6379`
- **示例**: `6379`

### REDIS_DB
- **描述**: Redis数据库编号
- **默认值**: `0`
- **示例**: `1`

### REDIS_PASSWORD
- **描述**: Redis密码
- **默认值**: `null`
- **示例**: `redis_password_123`

## 🤖 LLM配置

### GEMINI_API_KEY
- **描述**: Google Gemini API密钥
- **默认值**: `""`
- **示例**: `AIzaSyC...`
- **获取方式**: [Google AI Studio](https://makersuite.google.com/app/apikey)

### GEMINI_MODEL
- **描述**: Gemini模型名称
- **默认值**: `gemini-1.5-pro`
- **可选值**: `gemini-pro`, `gemini-1.5-pro`, `gemini-pro-vision`

### GEMINI_TEMPERATURE
- **描述**: Gemini生成温度
- **默认值**: `0.1`
- **范围**: 0.0-2.0

### GEMINI_MAX_TOKENS
- **描述**: Gemini最大生成token数
- **默认值**: `8192`
- **范围**: 1-32768

### OLLAMA_BASE_URL
- **描述**: Ollama服务基础URL
- **默认值**: `http://localhost:11434`
- **示例**: `http://ollama-server:11434`

### OLLAMA_MODEL
- **描述**: Ollama模型名称
- **默认值**: `llama3.1:8b`
- **示例**: `qwen2.5:3b`, `llama3.1:70b`

### OLLAMA_TIMEOUT
- **描述**: Ollama请求超时时间(秒)
- **默认值**: `300`
- **示例**: `600`

## 📁 文件存储配置

### UPLOAD_DIR
- **描述**: 文件上传目录路径
- **默认值**: `./uploads`
- **示例**: `/app/uploads`

### MAX_FILE_SIZE
- **描述**: 最大文件大小(字节)
- **默认值**: `10485760` (10MB)
- **示例**: `52428800` (50MB)

## 📝 日志配置

### LOG_LEVEL
- **描述**: 日志级别
- **默认值**: `INFO`
- **可选值**: `TRACE`, `DEBUG`, `INFO`, `SUCCESS`, `WARNING`, `ERROR`, `CRITICAL`

### LOG_ROTATION
- **描述**: 日志轮转间隔
- **默认值**: `1 week`
- **示例**: `1 day`, `100 MB`

### LOG_RETENTION
- **描述**: 日志保留期
- **默认值**: `1 month`
- **示例**: `3 months`, `1 year`

## ⚡ 性能配置

### HTTP_TIMEOUT
- **描述**: HTTP请求超时时间(秒)
- **默认值**: `30`
- **示例**: `60`

### HTTP_MAX_RETRIES
- **描述**: HTTP最大重试次数
- **默认值**: `3`
- **示例**: `5`

### MAX_DOCUMENT_SIZE
- **描述**: 最大文档大小(字节)
- **默认值**: `5242880` (5MB)
- **示例**: `10485760` (10MB)

### MAX_CONCURRENT_TESTS
- **描述**: 最大并发测试执行数
- **默认值**: `10`
- **示例**: `20`

### MAX_CONCURRENT_ANALYSIS
- **描述**: 最大并发分析任务数
- **默认值**: `5`
- **示例**: `10`

## 🔧 配置示例

### 开发环境 (.env.development)
```bash
# 应用配置
DEBUG=true
ENVIRONMENT=development

# 数据库配置
DB_HOST=localhost
DB_PORT=5432
DB_NAME=spec2test_dev
DB_USER=dev_user
DB_PASSWORD=dev_password
DB_ECHO=true

# LLM配置
GEMINI_API_KEY=your_gemini_api_key_here
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=qwen2.5:3b

# 并发配置 (保守设置)
SPEC2TEST_MAX_CONCURRENT_WORKERS=3
SPEC2TEST_CONCURRENT_THRESHOLD=5

# 日志配置
LOG_LEVEL=DEBUG
```

### 生产环境 (.env.production)
```bash
# 应用配置
DEBUG=false
ENVIRONMENT=production

# 数据库配置
DB_HOST=prod-db.example.com
DB_PORT=5432
DB_NAME=spec2test_prod
DB_USER=prod_user
DB_PASSWORD=${DB_PASSWORD_SECRET}
DB_ECHO=false

# LLM配置
GEMINI_API_KEY=${GEMINI_API_KEY_SECRET}
GEMINI_MODEL=gemini-1.5-pro

# 并发配置 (高性能设置)
SPEC2TEST_MAX_CONCURRENT_WORKERS=12
SPEC2TEST_CONCURRENT_THRESHOLD=3

# 性能配置
MAX_CONCURRENT_TESTS=20
MAX_CONCURRENT_ANALYSIS=10

# 日志配置
LOG_LEVEL=INFO
LOG_ROTATION=1 day
LOG_RETENTION=3 months
```

### Docker环境
```bash
# docker-compose.yml 环境变量
environment:
  - DEBUG=false
  - DB_HOST=postgres
  - DB_NAME=spec2test
  - DB_USER=spec2test_user
  - DB_PASSWORD=secure_password
  - REDIS_HOST=redis
  - GEMINI_API_KEY=${GEMINI_API_KEY}
  - SPEC2TEST_MAX_CONCURRENT_WORKERS=8
  - SPEC2TEST_CONCURRENT_THRESHOLD=3
```

## 🎯 并发配置最佳实践

### 根据LLM提供商调整
```bash
# 使用Ollama本地模型
SPEC2TEST_MAX_CONCURRENT_WORKERS=3
SPEC2TEST_CONCURRENT_THRESHOLD=5

# 使用Gemini云端API
SPEC2TEST_MAX_CONCURRENT_WORKERS=10
SPEC2TEST_CONCURRENT_THRESHOLD=3

# 使用OpenAI GPT
SPEC2TEST_MAX_CONCURRENT_WORKERS=8
SPEC2TEST_CONCURRENT_THRESHOLD=3
```

### 根据硬件资源调整
```bash
# 低配置服务器 (2核4GB)
SPEC2TEST_MAX_CONCURRENT_WORKERS=2

# 中等配置服务器 (4核8GB)
SPEC2TEST_MAX_CONCURRENT_WORKERS=5

# 高配置服务器 (8核16GB+)
SPEC2TEST_MAX_CONCURRENT_WORKERS=10
```

### 根据API配额调整
```bash
# 免费API配额
SPEC2TEST_MAX_CONCURRENT_WORKERS=3

# 付费API配额
SPEC2TEST_MAX_CONCURRENT_WORKERS=10

# 企业级API配额
SPEC2TEST_MAX_CONCURRENT_WORKERS=20
```

## 🔍 配置验证

使用以下命令验证配置是否正确：

```bash
# 检查配置加载
python -c "from app.config import get_settings; print(get_settings().performance.max_concurrent_workers)"

# 检查环境变量
echo $SPEC2TEST_MAX_CONCURRENT_WORKERS

# 运行配置测试
python scripts/test_config.py
```

## ⚠️ 注意事项

1. **并发数不是越高越好**: 过高的并发数可能导致API限流或资源耗尽
2. **监控资源使用**: 调整并发配置后，监控CPU、内存和网络使用情况
3. **API配额管理**: 云端LLM服务通常有API调用限制，注意配额管理
4. **环境隔离**: 不同环境使用不同的配置文件，避免配置混乱

## 📞 支持

如有配置问题，请参考：
- [项目文档](.doc/)
- [开发指南](.dev/)
- [GitHub Issues](https://github.com/your-repo/issues)

---

**最后更新**: 2025-01-15  
**下次更新**: 配置新功能时更新
