# Spec2Test æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£æè¿°äº†å¦‚ä½•è¿è¡Œæµ‹è¯•ä»¥åŠé¡¹ç›®çš„æµ‹è¯•ç­–ç•¥ã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡

åŸºäº `test.yaml` æ¥å£æ–‡æ¡£ï¼Œæœ¬é¡¹ç›®å®ç°äº†å…¨é¢çš„æµ‹è¯•ç­–ç•¥ï¼š

1. **æ–‡æ¡£ä¸Šä¼ æµ‹è¯•** - éªŒè¯OpenAPIæ–‡æ¡£ä¸Šä¼ åŠŸèƒ½
2. **æ–‡æ¡£è§£ææµ‹è¯•** - éªŒè¯æ–‡æ¡£è§£æå’Œè´¨é‡åˆ†æ
3. **APIå…¼å®¹æ€§æµ‹è¯•** - éªŒè¯å®é™…APIä¸è§„èŒƒçš„ä¸€è‡´æ€§
4. **é”™è¯¯å¤„ç†æµ‹è¯•** - éªŒè¯å„ç§é”™è¯¯åœºæ™¯çš„å¤„ç†
5. **æ€§èƒ½æµ‹è¯•** - éªŒè¯ç³»ç»Ÿæ€§èƒ½å’Œè´Ÿè½½èƒ½åŠ›

## ğŸ“ æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ conftest.py                    # pytesté…ç½®å’Œfixtures
â”œâ”€â”€ fixtures/                      # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ poor_quality_openapi.yaml
â”‚   â””â”€â”€ sample_openapi.yaml
â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ test_openapi_parser.py
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_document_upload.py    # æ–‡æ¡£ä¸Šä¼ å’Œè§£ææµ‹è¯•
â”‚   â””â”€â”€ test_error_scenarios.py    # é”™è¯¯åœºæ™¯æµ‹è¯•
â”œâ”€â”€ compatibility/                 # å…¼å®¹æ€§æµ‹è¯•
â”‚   â””â”€â”€ test_api_compatibility.py  # APIå…¼å®¹æ€§æµ‹è¯•
â”œâ”€â”€ performance/                   # æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ test_load_testing.py       # è´Ÿè½½å’Œæ€§èƒ½æµ‹è¯•
â””â”€â”€ utils.py                       # æµ‹è¯•å·¥å…·å‡½æ•°
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…ä¾èµ–
make install

# æˆ–è®¾ç½®å¼€å‘ç¯å¢ƒ
make dev-setup
```

### 2. è¿è¡Œæµ‹è¯•

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# è¿è¡ŒåŸºæœ¬æµ‹è¯•å¥—ä»¶
make test

# ä½¿ç”¨test.yamlè¿è¡Œç›¸å…³æµ‹è¯•
make test-yaml
```

## ğŸ“‹ æµ‹è¯•å‘½ä»¤è¯¦è§£

### åŸºç¡€æµ‹è¯•å‘½ä»¤

```bash
# å•å…ƒæµ‹è¯•
make test-unit
python run_tests.py unit

# é›†æˆæµ‹è¯•
make test-integration
python run_tests.py integration

# APIæµ‹è¯•
make test-api
python run_tests.py api
```

### ä¸“é¡¹æµ‹è¯•å‘½ä»¤

```bash
# å…¼å®¹æ€§æµ‹è¯•
make test-compatibility
python run_tests.py compatibility

# é”™è¯¯å¤„ç†æµ‹è¯•
make test-error
python run_tests.py error

# æ€§èƒ½æµ‹è¯•
make test-performance
python run_tests.py performance
```

### ç»¼åˆæµ‹è¯•å‘½ä»¤

```bash
# æ‰€æœ‰æµ‹è¯•ï¼ˆé™¤æ…¢é€Ÿæµ‹è¯•ï¼‰
make test-all
python run_tests.py all

# å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆåŒ…æ‹¬æ…¢é€Ÿæµ‹è¯•ï¼‰
make test-full
python run_tests.py full

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test-coverage
python run_tests.py coverage
```

### ç‰¹å®šæ–‡æ¡£æµ‹è¯•

```bash
# ä½¿ç”¨test.yamlæ–‡ä»¶è¿è¡Œç›¸å…³æµ‹è¯•
make test-yaml
python run_tests.py yaml
```

## ğŸ§ª æµ‹è¯•ç±»å‹è¯´æ˜

### 1. æ–‡æ¡£ä¸Šä¼ æµ‹è¯• (`test_document_upload.py`)

- âœ… å¥åº·æ£€æŸ¥å’ŒåŸºæœ¬APIä¿¡æ¯
- âœ… æˆåŠŸä¸Šä¼ test.yamlæ–‡æ¡£
- âœ… æ–‡æ¡£è§£æå’Œè´¨é‡åˆ†æ
- âœ… è·å–æ–‡æ¡£åˆ—è¡¨
- âœ… åˆ é™¤æ–‡æ¡£
- âœ… éªŒè¯test.yamlå†…å®¹ç»“æ„
- âœ… éªŒè¯APIç«¯ç‚¹è¯¦æƒ…

### 2. é”™è¯¯å¤„ç†æµ‹è¯• (`test_error_scenarios.py`)

- âŒ æ— æ•ˆæ–‡ä»¶ç±»å‹å¤„ç†
- âŒ ç©ºæ–‡ä»¶å’ŒæŸåæ–‡ä»¶å¤„ç†
- âŒ æ ¼å¼é”™è¯¯çš„YAMLå¤„ç†
- âŒ ä¸å­˜åœ¨çš„æ–‡æ¡£IDå¤„ç†
- âŒ å¹¶å‘æ“ä½œå¤„ç†
- âŒ è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### 3. APIå…¼å®¹æ€§æµ‹è¯• (`test_api_compatibility.py`)

- ğŸ”„ OpenAPIç‰ˆæœ¬å…¼å®¹æ€§
- ğŸ”„ APIä¿¡æ¯ä¸€è‡´æ€§
- ğŸ”„ ç«¯ç‚¹å­˜åœ¨æ€§éªŒè¯
- ğŸ”„ è¯·æ±‚/å“åº”æ¨¡å‹éªŒè¯
- ğŸ”„ è®¤è¯æ–¹æ¡ˆéªŒè¯
- ğŸ”„ é”™è¯¯å“åº”ä¸€è‡´æ€§

### 4. æ€§èƒ½æµ‹è¯• (`test_load_testing.py`)

- âš¡ å“åº”æ—¶é—´åŸºçº¿æµ‹è¯•
- âš¡ æ–‡ä»¶ä¸Šä¼ æ€§èƒ½æµ‹è¯•
- âš¡ å¹¶å‘è¯·æ±‚æµ‹è¯•
- âš¡ å†…å­˜å’Œèµ„æºä½¿ç”¨æµ‹è¯•
- âš¡ è´Ÿè½½å‹åŠ›æµ‹è¯•ï¼ˆæ ‡è®°ä¸ºslowï¼‰

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Š

```bash
make test-coverage
# æŠ¥å‘Šä½ç½®: reports/coverage/index.html
```

### JUnit XMLæŠ¥å‘Š

```bash
# è‡ªåŠ¨ç”Ÿæˆåœ¨: reports/junit.xml
```

### æ€§èƒ½æŠ¥å‘Š

```bash
make test-performance
# åŒ…å«å“åº”æ—¶é—´ç»Ÿè®¡
```

## ğŸ·ï¸ æµ‹è¯•æ ‡è®°

ä½¿ç”¨pytestæ ‡è®°æ¥åˆ†ç±»å’Œè¿‡æ»¤æµ‹è¯•ï¼š

```bash
# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
pytest -m "unit"                    # å•å…ƒæµ‹è¯•
pytest -m "integration"             # é›†æˆæµ‹è¯•
pytest -m "api"                     # APIæµ‹è¯•
pytest -m "compatibility"           # å…¼å®¹æ€§æµ‹è¯•
pytest -m "error_handling"          # é”™è¯¯å¤„ç†æµ‹è¯•
pytest -m "performance"             # æ€§èƒ½æµ‹è¯•
pytest -m "slow"                    # æ…¢é€Ÿæµ‹è¯•
pytest -m "not slow"                # æ’é™¤æ…¢é€Ÿæµ‹è¯•
```

## ğŸ”§ é…ç½®æ–‡ä»¶

### pytest.ini

åŒ…å«pytestçš„å…¨å±€é…ç½®ï¼ŒåŒ…æ‹¬ï¼š
- æµ‹è¯•å‘ç°è§„åˆ™
- è¾“å‡ºæ ¼å¼é…ç½®
- è¦†ç›–ç‡è®¾ç½®
- æ ‡è®°å®šä¹‰
- è­¦å‘Šè¿‡æ»¤

### conftest.py

åŒ…å«æµ‹è¯•fixtureså’Œé…ç½®ï¼š
- æ•°æ®åº“æµ‹è¯•é…ç½®
- HTTPå®¢æˆ·ç«¯é…ç½®
- æµ‹è¯•æ•°æ®fixtures
- è¾…åŠ©å‡½æ•°

## ğŸ› è°ƒè¯•æµ‹è¯•

### è¯¦ç»†è¾“å‡º

```bash
pytest -v -s                        # è¯¦ç»†è¾“å‡ºï¼Œä¸æ•è·print
pytest --tb=long                    # è¯¦ç»†é”™è¯¯è¿½è¸ª
pytest --pdb                        # å¤±è´¥æ—¶è¿›å…¥è°ƒè¯•å™¨
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
pytest tests/integration/test_document_upload.py::test_upload_test_yaml
pytest -k "test_upload"             # è¿è¡Œåç§°åŒ…å«"test_upload"çš„æµ‹è¯•
```

### å¤±è´¥é‡è¯•

```bash
pytest --lf                         # åªè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•
pytest --ff                         # å…ˆè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•
```

## ğŸ“ˆ æŒç»­é›†æˆ

### CI/CDæµæ°´çº¿

```bash
make ci                             # å®Œæ•´CIæ£€æŸ¥
```

åŒ…å«ï¼š
1. ç¯å¢ƒè®¾ç½®
2. ä»£ç æ£€æŸ¥ï¼ˆlintï¼‰
3. ç±»å‹æ£€æŸ¥
4. å®‰å…¨æ£€æŸ¥
5. æµ‹è¯•è¦†ç›–ç‡

### å‘å¸ƒå‰æ£€æŸ¥

```bash
make pre-release                    # å‘å¸ƒå‰å®Œæ•´æ£€æŸ¥
```

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»
- æ¯ä¸ªæµ‹è¯•éƒ½æ˜¯ç‹¬ç«‹çš„
- ä½¿ç”¨fixturesæä¾›æµ‹è¯•æ•°æ®
- æµ‹è¯•åè‡ªåŠ¨æ¸…ç†

### 2. æµ‹è¯•æ•°æ®
- ä½¿ç”¨çœŸå®çš„test.yamlæ–‡ä»¶
- æä¾›å¤šç§æµ‹è¯•åœºæ™¯çš„æ•°æ®
- åŒ…å«è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æƒ…å†µ

### 3. æ–­è¨€ç­–ç•¥
- æ˜ç¡®çš„æ–­è¨€æ¶ˆæ¯
- éªŒè¯å…³é”®å­—æ®µå’Œç»“æ„
- æ£€æŸ¥é”™è¯¯å“åº”æ ¼å¼

### 4. æ€§èƒ½è€ƒè™‘
- æ ‡è®°æ…¢é€Ÿæµ‹è¯•
- åˆç†çš„è¶…æ—¶è®¾ç½®
- å¹¶å‘æµ‹è¯•çš„èµ„æºç®¡ç†

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. æµ‹è¯•å¤±è´¥

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://localhost:8000/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
```

### 2. è¦†ç›–ç‡ä¸è¶³

```bash
# æŸ¥çœ‹è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
make test-coverage
open reports/coverage/index.html
```

### 3. æ€§èƒ½æµ‹è¯•è¶…æ—¶

```bash
# è·³è¿‡æ…¢é€Ÿæµ‹è¯•
pytest -m "not slow"

# è°ƒæ•´è¶…æ—¶è®¾ç½®
# åœ¨conftest.pyä¸­ä¿®æ”¹timeouté…ç½®
```

## ğŸ“ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. é€‰æ‹©åˆé€‚çš„æµ‹è¯•ç›®å½•
2. ä½¿ç”¨é€‚å½“çš„æµ‹è¯•æ ‡è®°
3. éµå¾ªå‘½åçº¦å®š
4. æ·»åŠ å¿…è¦çš„æ–‡æ¡£

### æµ‹è¯•å‘½åçº¦å®š

- `test_*.py` - æµ‹è¯•æ–‡ä»¶
- `test_*()` - æµ‹è¯•å‡½æ•°
- `Test*` - æµ‹è¯•ç±»
- æè¿°æ€§çš„æµ‹è¯•åç§°

### æäº¤å‰æ£€æŸ¥

```bash
make dev                            # å¼€å‘æ£€æŸ¥
make ci                             # CIæ£€æŸ¥
```

---

ğŸ‰ **å¼€å§‹æµ‹è¯•å§ï¼** ä½¿ç”¨ `make test-yaml` æ¥éªŒè¯ä½ çš„ `test.yaml` æ¥å£æ–‡æ¡£ã€‚
