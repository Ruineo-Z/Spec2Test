# Geminiç»“æ„åŒ–è¾“å‡ºæµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æµ‹è¯•Gemini 2.5 Flashçš„ç»“æ„åŒ–è¾“å‡ºåŠŸèƒ½ã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡

éªŒè¯Geminiå®¢æˆ·ç«¯èƒ½å¤Ÿï¼š
1. âœ… æ­£ç¡®è¿æ¥Gemini API
2. âœ… ç”Ÿæˆç¬¦åˆSchemaçš„ç»“æ„åŒ–è¾“å‡º
3. âœ… å¤„ç†å„ç§é”™è¯¯æƒ…å†µ
4. âœ… ä¿æŒè¾“å‡ºçš„ä¸€è‡´æ€§
5. âœ… æ”¯æŒå¤æ‚çš„æ–‡æ¡£åˆ†æä»»åŠ¡

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### 1. è·å–Gemini APIå¯†é’¥

1. è®¿é—® [Google AI Studio](https://aistudio.google.com/)
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. ç”ŸæˆAPIå¯†é’¥
4. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export GEMINI_API_KEY=your_api_key_here
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…Gemini SDK
pip install google-generativeai

# æˆ–è€…ä½¿ç”¨é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

## ğŸ§ª æµ‹è¯•æ–¹å¼

### 1. å•å…ƒæµ‹è¯•ï¼ˆMockæµ‹è¯•ï¼‰

è¿è¡Œä¸éœ€è¦çœŸå®APIçš„å•å…ƒæµ‹è¯•ï¼š

```bash
# æµ‹è¯•æ‰€æœ‰Geminiå®¢æˆ·ç«¯åŠŸèƒ½
pytest tests/unit/test_gemini_client.py -v

# æµ‹è¯•ç‰¹å®šåŠŸèƒ½
pytest tests/unit/test_gemini_client.py::TestGeminiClient::test_generate_structured_success -v
```

### 2. é›†æˆæµ‹è¯•ï¼ˆçœŸå®APIï¼‰

âš ï¸ **æ³¨æ„ï¼šé›†æˆæµ‹è¯•ä¼šè°ƒç”¨çœŸå®çš„Gemini APIï¼Œå¯èƒ½äº§ç”Ÿè´¹ç”¨ï¼**

```bash
# å¯ç”¨é›†æˆæµ‹è¯•
export ENABLE_GEMINI_INTEGRATION_TESTS=1
export GEMINI_API_KEY=your_api_key

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration/test_gemini_real_api.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/integration/test_gemini_real_api.py::TestGeminiRealAPI::test_real_gemini_health_check -v
```

### 3. æ¼”ç¤ºè„šæœ¬

è¿è¡Œäº¤äº’å¼æ¼”ç¤ºï¼š

```bash
# è®¾ç½®APIå¯†é’¥
export GEMINI_API_KEY=your_api_key

# è¿è¡Œæ¼”ç¤º
python scripts/test_gemini_structured_output.py
```

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹è¯´æ˜

### å•å…ƒæµ‹è¯•è¦†ç›–

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹ | è¯´æ˜ |
|---------|---------|------|
| **é…ç½®æµ‹è¯•** | `test_valid_gemini_config_creation` | éªŒè¯é…ç½®åˆ›å»º |
| | `test_gemini_config_defaults` | éªŒè¯é»˜è®¤å€¼ |
| | `test_gemini_config_validation_errors` | éªŒè¯å‚æ•°æ ¡éªŒ |
| **å®¢æˆ·ç«¯æµ‹è¯•** | `test_gemini_client_initialization_success` | éªŒè¯å®¢æˆ·ç«¯åˆå§‹åŒ– |
| | `test_gemini_client_initialization_failure_*` | éªŒè¯åˆå§‹åŒ–é”™è¯¯å¤„ç† |
| **ç»“æ„åŒ–è¾“å‡º** | `test_generate_structured_success` | éªŒè¯ç»“æ„åŒ–ç”ŸæˆæˆåŠŸ |
| | `test_generate_structured_empty_response` | éªŒè¯ç©ºå“åº”å¤„ç† |
| | `test_generate_structured_invalid_json` | éªŒè¯æ— æ•ˆJSONå¤„ç† |
| | `test_generate_structured_timeout` | éªŒè¯è¶…æ—¶å¤„ç† |
| **æ–‡æœ¬ç”Ÿæˆ** | `test_generate_text_success` | éªŒè¯æ™®é€šæ–‡æœ¬ç”Ÿæˆ |
| **å¥åº·æ£€æŸ¥** | `test_health_check_success` | éªŒè¯å¥åº·æ£€æŸ¥æˆåŠŸ |
| | `test_health_check_failure` | éªŒè¯å¥åº·æ£€æŸ¥å¤±è´¥ |

### é›†æˆæµ‹è¯•è¦†ç›–

| æµ‹è¯•ç”¨ä¾‹ | è¯´æ˜ | éªŒè¯å†…å®¹ |
|---------|------|----------|
| `test_real_gemini_health_check` | çœŸå®APIå¥åº·æ£€æŸ¥ | APIè¿æ¥æ€§ |
| `test_real_structured_output_quick_assessment` | çœŸå®ç»“æ„åŒ–è¾“å‡º | Schemaç¬¦åˆæ€§ã€å­—æ®µæœ‰æ•ˆæ€§ |
| `test_real_structured_output_consistency` | è¾“å‡ºä¸€è‡´æ€§ | å¤šæ¬¡è°ƒç”¨ç»“æœçš„ä¸€è‡´æ€§ |
| `test_real_error_handling` | çœŸå®é”™è¯¯å¤„ç† | APIé”™è¯¯å“åº”å¤„ç† |

## ğŸ” æµ‹è¯•æ•°æ®

### ç¤ºä¾‹OpenAPIæ–‡æ¡£

æµ‹è¯•ä½¿ç”¨çœŸå®çš„OpenAPI 3.0æ–‡æ¡£ï¼ŒåŒ…å«ï¼š

- âœ… å®Œæ•´çš„infoéƒ¨åˆ†
- âœ… å¤šä¸ªç«¯ç‚¹ï¼ˆGETã€POSTï¼‰
- âœ… è¯¦ç»†çš„å‚æ•°å®šä¹‰
- âœ… å®Œæ•´çš„å“åº”å®šä¹‰
- âœ… ç»„ä»¶Schemaå®šä¹‰
- âœ… è¯·æ±‚/å“åº”ç¤ºä¾‹

### é¢„æœŸè¾“å‡ºæ ¼å¼

```json
{
  "endpoint_count": 3,
  "complexity_score": 0.6,
  "has_quality_issues": false,
  "needs_detailed_analysis": true,
  "estimated_analysis_time": 15,
  "reason": "æ–‡æ¡£ç»“æ„å®Œæ•´ï¼Œä½†éƒ¨åˆ†ç«¯ç‚¹ç¼ºå°‘è¯¦ç»†ç¤ºä¾‹",
  "quick_issues": [
    "DELETEç«¯ç‚¹ç¼ºå°‘è¯·æ±‚ç¤ºä¾‹",
    "é”™è¯¯å“åº”ç¼ºå°‘è¯¦ç»†Schema"
  ],
  "overall_impression": "good",
  "schema_version": "1.0",
  "generated_at": "2024-01-01T12:00:00.000Z"
}
```

## âš¡ æ€§èƒ½åŸºå‡†

### å“åº”æ—¶é—´æœŸæœ›

| æ“ä½œç±»å‹ | é¢„æœŸæ—¶é—´ | è¯´æ˜ |
|---------|---------|------|
| å¥åº·æ£€æŸ¥ | < 3ç§’ | ç®€å•æ–‡æœ¬ç”Ÿæˆ |
| å¿«é€Ÿè¯„ä¼° | < 8ç§’ | å°å‹æ–‡æ¡£ï¼ˆ<10ç«¯ç‚¹ï¼‰ |
| è¯¦ç»†åˆ†æ | < 15ç§’ | ä¸­å‹æ–‡æ¡£ï¼ˆ10-30ç«¯ç‚¹ï¼‰ |
| å¤§å‹æ–‡æ¡£ | < 30ç§’ | å¤§å‹æ–‡æ¡£ï¼ˆ>30ç«¯ç‚¹ï¼‰ |

### Tokenæ¶ˆè€—ä¼°ç®—

| æ–‡æ¡£å¤§å° | è¾“å…¥Token | è¾“å‡ºToken | æ€»æˆæœ¬ä¼°ç®— |
|---------|-----------|-----------|------------|
| å°å‹ï¼ˆ<5ç«¯ç‚¹ï¼‰ | ~2,000 | ~500 | $0.01 |
| ä¸­å‹ï¼ˆ5-20ç«¯ç‚¹ï¼‰ | ~8,000 | ~1,000 | $0.03 |
| å¤§å‹ï¼ˆ>20ç«¯ç‚¹ï¼‰ | ~20,000 | ~2,000 | $0.08 |

## ğŸš¨ æ³¨æ„äº‹é¡¹

### APIé™åˆ¶

1. **é€Ÿç‡é™åˆ¶**ï¼šGemini APIæœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶
2. **Tokené™åˆ¶**ï¼šå•æ¬¡è¯·æ±‚æœ€å¤§1Mè¾“å…¥tokenï¼Œ8Kè¾“å‡ºtoken
3. **æˆæœ¬æ§åˆ¶**ï¼šæ¯æ¬¡APIè°ƒç”¨éƒ½ä¼šäº§ç”Ÿè´¹ç”¨

### æµ‹è¯•æœ€ä½³å®è·µ

1. **å•å…ƒæµ‹è¯•ä¼˜å…ˆ**ï¼šå¤§éƒ¨åˆ†æµ‹è¯•ä½¿ç”¨Mockï¼Œé¿å…APIè´¹ç”¨
2. **é›†æˆæµ‹è¯•è°¨æ…**ï¼šåªåœ¨å¿…è¦æ—¶è¿è¡ŒçœŸå®APIæµ‹è¯•
3. **é”™è¯¯å¤„ç†å®Œæ•´**ï¼šæµ‹è¯•å„ç§å¼‚å¸¸æƒ…å†µ
4. **ä¸€è‡´æ€§éªŒè¯**ï¼šç¡®ä¿å¤šæ¬¡è°ƒç”¨ç»“æœç¨³å®š

### æ•…éšœæ’é™¤

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|----------|
| APIå¯†é’¥é”™è¯¯ | å¯†é’¥æ— æ•ˆæˆ–è¿‡æœŸ | é‡æ–°ç”Ÿæˆå¯†é’¥ |
| è¿æ¥è¶…æ—¶ | ç½‘ç»œé—®é¢˜æˆ–APIé™æµ | å¢åŠ è¶…æ—¶æ—¶é—´ï¼Œæ·»åŠ é‡è¯• |
| JSONè§£æé”™è¯¯ | LLMè¿”å›æ ¼å¼ä¸æ­£ç¡® | æ£€æŸ¥Schemaå®šä¹‰ï¼Œè°ƒæ•´æç¤ºè¯ |
| æƒé™é”™è¯¯ | APIå¯†é’¥æƒé™ä¸è¶³ | æ£€æŸ¥é¡¹ç›®è®¾ç½®å’ŒAPIå¯ç”¨çŠ¶æ€ |

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åï¼ŒæŸ¥çœ‹è¯¦ç»†æŠ¥å‘Šï¼š

```bash
# ç”ŸæˆHTMLæµ‹è¯•æŠ¥å‘Š
pytest tests/unit/test_gemini_client.py --html=reports/gemini_test_report.html

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/unit/test_gemini_client.py --cov=app.core.llm --cov-report=html
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å®ŒæˆGeminiç»“æ„åŒ–è¾“å‡ºæµ‹è¯•
2. ğŸ”„ å®ç°æ™ºèƒ½åˆ†å±‚åˆ†æå™¨
3. ğŸ”„ é›†æˆæ–‡æ¡£è´¨é‡åˆ†ææµæ°´çº¿
4. ğŸ”„ æ·»åŠ æ›´å¤šSchemaç±»å‹æ”¯æŒ

---

**è®°ä½ï¼šå§‹ç»ˆéµå¾ªTDDåŸåˆ™ï¼Œå…ˆå†™æµ‹è¯•ï¼Œåå®ç°åŠŸèƒ½ï¼** ğŸš€
